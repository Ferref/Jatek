-- Példa adatok beillesztése a Felhasznalo táblába
INSERT INTO Felhasznalo (nev, jelszo) VALUES
('petiAFelhasznalo', 'jelszo1'),
('robiAFelhasznalo', 'jelszo2'),
('belaAFelhasznalo', 'jelszo3'),
('annaAFelhasznalo', 'jelszo4'),
('laciAFelhasznalo', 'jelszo5');

-- Példa adatok beillesztése a Szerver táblába
INSERT INTO Szerver (nev) VALUES
('Valuri'),
('Behemot'),
('Elvendur');

-- Példa adatok beillesztése a Kaszt táblába
INSERT INTO Kaszt (nev, eleteroModosito, sebzesModosito) VALUES
('Harcos', 100, 100),
('Ijjász', 100, 100),
('Mágus', 50, 150);

-- Példa adatok beillesztése a Helyszin táblába
INSERT INTO Helyszin (nev, minimumSzint) VALUES
('Erdei tisztás', 1),
('Mágikus torony', 3),
('Sötét barlang', 5);

-- Példa adatok beillesztése a Jatekos táblába
INSERT INTO Jatekos (nev, szerverId, felhasznaloId, nem, kasztId, helyszinId) VALUES
('PetiJatekos1', 1, 1, 'F', 1, 1),
('RobiJatekos1', 1, 2, 'N', 2, 1),
('BelaJatekos1', 2, 3, 'F', 1, 2),
('AnnaJatekos1', 2, 4, 'N', 3, 2),
('LaciJatekos1', 3, 5, 'F', 2, 3);

-- Példa adatok beillesztése a Kepesseg táblába
INSERT INTO Kepesseg (nev, sebzes, kasztId) VALUES
('Tűzgömb', 150, 2),
('Kardcsapás', 120, 1),
('Nyílvessző', 100, 3),
('Varázslat', 180, 3);

-- Példa adatok beillesztése a Felszereles táblába
INSERT INTO Felszereles (nev, kasztId, sebzes, eletero, minimumSzint) VALUES
('Védelem pajzs', 1, 50, 200, 1),
('Varázskönyv', 2, 30, 80, 1),
('Íj', 2, 40, 90, 1),
('Lopakodó köpeny', 3, 20, 70, 1);

-- Példa adatok beillesztése a Szorny táblába
INSERT INTO Szorny (nev, tapasztalatPontotAd, eletero, sebzes, aranyatDobhat, helyszinId) VALUES
('Goblin', 50, 500, 100, 20, 1),
('Sárkány', 200, 1500, 300, 100, 2),
('Harcos trollok', 100, 800, 200, 50, 3),
('Vad orkok', 80, 600, 150, 30, 1),
('Varázsló koboldok', 120, 700, 180, 40, 2);

-- Példa adatok beillesztése a Csoport táblába
INSERT INTO Csoport (nev, tagokSzama) VALUES
('Kalandorok', 3),
('Csavargók', 2),
('IngyomBingyomCrew', 2);

-- Példa adatok beillesztése a Bolt táblába
INSERT INTO Bolt (nev) VALUES
('Erdei kisbolt'),
('A mocsárosi bolt'),
('A kinemmondom bolt');

-- Példa adatok beillesztése a BoltFelszereles táblába
INSERT INTO BoltFelszereles (boltId, felszerelesId) VALUES
(1, 1),
(2, 2),
(3, 3),
(1, 4),
(2, 1);

-- Használati esetek

-- 1. Az összes játékos neve és szintje, akiknek a szintje kisebb mint 5.
SELECT nev, szint FROM Jatekos WHERE szint < 5;

-- 2. Az összes felhasználó neve és szervere, akik a "Valuri" szerveren vannak.
SELECT Felhasznalo.nev, Szerver.nev AS szerver
FROM Szerver
JOIN Jatekos ON Szerver.id = Jatekos.szerverId
JOIN Felhasznalo ON Jatekos.felhasznaloId = Felhasznalo.id
WHERE Szerver.nev = 'Valuri';

-- 3. Az összes kaszt neve és azonosítója, amelyhez képességet társítottak.
SELECT Kaszt.nev AS kaszt_neve, Kepesseg.nev AS kepseg_neve
FROM Kaszt
JOIN Kepesseg ON Kaszt.id = Kepesseg.kasztId;

-- 4. Az összes felszerelés neve és azonosítója, amelynek a sebzése nagyobb mint 100.
SELECT nev, id FROM Felszereles WHERE sebzes > 100;

-- 5. Az összes szörny neve és szintje, akik 1000 tapasztalatpontot adnak.
SELECT nev, szint FROM Szorny WHERE tapasztalatPontotAd = 1000;

-- 6. Az összes helyszín neve és azonosítója, amelyen legalább 2 játékos van.
SELECT nev, id
FROM Helyszin
WHERE id IN (SELECT helyszinId FROM Jatekos GROUP BY helyszinId HAVING COUNT(*) >= 2);

-- 7. Az összes csoport neve és tagok száma.
SELECT nev, tagokSzama FROM Csoport;

-- 8. Az összes bolt neve, amelynek nevében szerepel az "Fegyverbolt" szó.
SELECT nev FROM Bolt WHERE nev LIKE '%Fegyverbolt%';

-- 9. Az összes képesség neve, amelyet a "Harcos" kaszthoz rendeltek.
SELECT Kepesseg.nev
FROM Kaszt
JOIN Kepesseg ON Kaszt.id = Kepesseg.kasztId
WHERE Kaszt.nev = 'Harcos';

-- 10. Az összes játékos neve és szervere, akik online státuszban vannak.
SELECT Felhasznalo.nev, Szerver.nev AS szerver
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Szerver ON Jatekos.szerverId = Szerver.id
WHERE Jatekos.online = TRUE;

-- 11. Az összes játékos neve és szintje, akiknek a szintje megegyezik az eleterojukkel.
SELECT nev, szint FROM Jatekos WHERE szint = eletero;

-- 12. Az összes játékos neve és helyszíne, akiknek a szintje legalább 15.
SELECT Jatekos.nev, Helyszin.nev AS helyszin
FROM Jatekos
JOIN Helyszin ON Jatekos.helyszinId = Helyszin.id
WHERE Jatekos.szint >= 15;

-- 13. Az összes játékos neve és kasztja, akik "Hamis" párbajraHívható tulajdonsággal rendelkeznek.
SELECT Felhasznalo.nev, Kaszt.nev AS kaszt
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Kaszt ON Jatekos.kasztId = Kaszt.id
WHERE Jatekos.parbajraHivhato = FALSE;

-- 14. Az összes felszerelés neve és eletere, amelyek minimumSzintje nagyobb mint 3.
SELECT nev, eletero FROM Felszereles WHERE minimumSzint > 3;

-- 15. Az összes szerver neve és számuk, amelyen több, mint 3 felhasználó van.
SELECT Szerver.nev, COUNT(Jatekos.felhasznaloId) AS felhasznalok_szama
FROM Szerver
JOIN Jatekos ON Szerver.id = Jatekos.szerverId
GROUP BY Szerver.nev
HAVING COUNT(Jatekos.felhasznaloId) > 3;

-- 16. Az összes játékos neve és szervere, akik nem "Hamis" párbajraHívható tulajdonsággal rendelkeznek és a helyszíne "Erdei tisztás".
SELECT Felhasznalo.nev, Szerver.nev AS szerver
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Szerver ON Jatekos.szerverId = Szerver.id
WHERE Jatekos.parbajraHivhato = FALSE AND Jatekos.helyszinId = 1;

-- 17. Az összes játékos neve és csoportja, akiknek az aranya több mint 500.
SELECT Felhasznalo.nev, Csoport.nev AS csoport
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Csoport ON Jatekos.csoportId = Csoport.id
WHERE Jatekos.arany > 500;

-- 18. Az összes szerver neve és szerverének azonosítója, ahol a felhasználók összes száma több, mint 10.
SELECT Szerver.nev, Szerver.id
FROM Szerver
JOIN Jatekos ON Szerver.id = Jatekos.szerverId
GROUP BY Szerver.id
HAVING COUNT(Jatekos.felhasznaloId) > 10;

-- 19. Az összes játékos neve és aranya, akiknek a szintje kisebb mint 10.
SELECT Felhasznalo.nev, Jatekos.arany
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
WHERE Jatekos.szint < 10;

-- 20. Az összes kaszt neve és azonosítója, amelyiknek az eleteroModositoja nagyobb mint 80.
SELECT nev, id FROM Kaszt WHERE eleteroModosito > 80;

-- 21. Az összes felszerelés neve és minimumSzintje, amelyiknek az eleteromodositoja kisebb mint 50.
SELECT nev, minimumSzint FROM Felszereles WHERE eletero < 50;

-- 22. Az összes szörny neve és helyszíne, akiknek a tapasztalatPontotAd-ja nagyobb mint 150.
SELECT nev, helyszinId FROM Szorny WHERE tapasztalatPontotAd > 150;

-- 23. Az összes játékos neve és szervere, akiknek a nevében szerepel az 'a' karakter legalább egyszer.
SELECT Felhasznalo.nev, Szerver.nev AS szerver
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Szerver ON Jatekos.szerverId = Szerver.id
WHERE Felhasznalo.nev LIKE '%a%';

-- 24. Az összes csoport neve és tagok száma, ahol a tagok száma páratlan.
SELECT nev, tagokSzama FROM Csoport WHERE tagokSzama % 2 = 1;

-- 25. Az összes bolt neve és azonosítója, amelyikben legalább 2 felszerelés van.
SELECT nev, id FROM Bolt WHERE id IN (SELECT boltId FROM BoltFelszereles GROUP BY boltId HAVING COUNT(*) >= 2);

-- 26. Az összes szerver neve és azonosítója, ahol legalább 1 online játékos van.
SELECT Szerver.nev, Szerver.id
FROM Szerver
JOIN Jatekos ON Szerver.id = Jatekos.szerverId
WHERE Jatekos.online = TRUE;

-- 27. Az összes helyszín neve és azonosítója, ahol legalább 1 szörny van.
SELECT nev, id FROM Helyszin WHERE id IN (SELECT helyszinId FROM Szorny);

-- 28. Az összes játékos neve és kasztja, akiknek a szervere "Behemot".
SELECT Felhasznalo.nev, Kaszt.nev AS kaszt
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Szerver ON Jatekos.szerverId = Szerver.id
JOIN Kaszt ON Jatekos.kasztId = Kaszt.id
WHERE Szerver.nev = 'Behemot';

-- 29. Az összes felszerelés neve és azonosítója, amelynek a minimumSzintje páratlan.
SELECT nev, id FROM Felszereles WHERE minimumSzint % 2 = 1;

-- 30. Az összes játékos neve és csoportja, akiknek az aranya kisebb mint 200 és szervere "Elvendur".
SELECT Felhasznalo.nev, Csoport.nev AS csoport
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Szerver ON Jatekos.szerverId = Szerver.id
JOIN Csoport ON Jatekos.csoportId = Csoport.id
WHERE Jatekos.arany < 200 AND Szerver.nev = 'Elvendur';

-- 31. Egy játékos kasztjának módosítása
UPDATE Jatekos SET kasztId = 3 WHERE nev = 'PetiJatekos1';

-- 32. Egy kaszt sebzésModositojának csökkentése
UPDATE Kaszt SET sebzesModosito = sebzesModosito - 20 WHERE id = 3;

-- 33. Egy felszerelés nevének módosítása
UPDATE Felszereles SET nev = 'ÚjFelszerelésNév' WHERE id = 4;

-- 34. Egy szörny tapasztalatPontotAd értékének növelése
UPDATE Szorny SET tapasztalatPontotAd = tapasztalatPontotAd + 50 WHERE id = 2;

-- 35. Egy bolt törlése, ahol legalább 3 felszerelés van
DELETE FROM Bolt WHERE id IN (SELECT boltId FROM BoltFelszereles GROUP BY boltId HAVING COUNT(*) >= 3);

-- 36. Egy felhasználó törlése, akinek a neve kezdődik "új"
DELETE FROM Felhasznalo WHERE nev LIKE 'új%';

-- 37. Egy csoport tagjainak számának növelése
UPDATE Csoport SET tagokSzama = tagokSzama + 2 WHERE id = 3;

-- 38. Egy helyszín minimumSzintjének csökkentése
UPDATE Helyszin SET minimumSzint = minimumSzint - 2 WHERE id = 2;

-- 39. Egy szerver nevének frissítése, ahol legalább 2 játékos online van
UPDATE Szerver SET nev = 'ÚjSzerverNév' WHERE id IN (SELECT szerverId FROM Jatekos WHERE online = TRUE GROUP BY szerverId HAVING COUNT(*) >= 2);

-- 40. Egy játékos online státuszának módosítása, akinek a neve tartalmazza a "J" karaktert
UPDATE Jatekos SET online = FALSE WHERE id IN (SELECT id FROM Jatekos WHERE nev LIKE '%J%');

-- 41. Az összes játékos neve, szervere és a leggyakrabban használt képesség neve.
SELECT Felhasznalo.nev, Szerver.nev AS szerver, Kepesseg.nev AS leggyakrabban_hasznalt_kepesseg
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Szerver ON Jatekos.szerverId = Szerver.id
JOIN (
    SELECT id, kepsegId
    FROM (
        SELECT id, kepsegId, ROW_NUMBER() OVER(PARTITION BY id ORDER BY COUNT(*) DESC) AS row_num
        FROM JatekosKepesseg
        GROUP BY id, kepsegId
    ) AS ranked
    WHERE row_num = 1
) AS leggyakrabban_hasznalt ON Jatekos.id = leggyakrabban_hasznalt.id
JOIN Kepesseg ON leggyakrabban_hasznalt.kepsegId = Kepesseg.id;

-- 42. Az összes kaszt neve és azonosítója, amelyikhez van olyan képesség, ami a kaszt általános sebzését módosítja.
SELECT DISTINCT Kaszt.nev, Kaszt.id
FROM Kaszt
JOIN Kepesseg ON Kaszt.id = Kepesseg.kasztId
WHERE Kepesseg.sebzesModosito IS NOT NULL;

-- 43. Az összes játékos neve és szervere, akiknek a szintje a szerverükön belül az átlagosnál magasabb.
SELECT Felhasznalo.nev, Szerver.nev AS szerver
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Szerver ON Jatekos.szerverId = Szerver.id
JOIN (
    SELECT szerverId, AVG(szint) AS atlag_szint
    FROM Jatekos
    GROUP BY szerverId
) AS atlagok ON Jatekos.szerverId = atlagok.szerverId
WHERE Jatekos.szint > atlagok.atlag_szint;

-- 44. Az összes játékos neve és csoportja, akik a legtöbb tapasztalatpontot gyűjtötték össze csoportjukban.
SELECT Felhasznalo.nev, Csoport.nev AS csoport, MAX(Jatekos.tapasztalatPont) AS max_tapasztalatpont
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Csoport ON Jatekos.csoportId = Csoport.id
GROUP BY Felhasznalo.nev, Csoport.nev;

-- 45. Az összes felszerelés neve és azonosítója, amelynek az eletero és a sebzés összege a legnagyobb.
SELECT nev, id
FROM Felszereles
ORDER BY eletero + sebzes DESC
LIMIT 1;

-- 46. Az összes szerver neve és a rajta lévő játékosok átlagos szintje.
SELECT Szerver.nev, AVG(Jatekos.szint) AS atlag_szint
FROM Szerver
JOIN Jatekos ON Szerver.id = Jatekos.szerverId
GROUP BY Szerver.nev;

-- 47. Az összes játékos neve és helyszíne, akiknek a kasztjuk olyan képességgel rendelkezik, ami a támadás sebzését módosítja.
SELECT Felhasznalo.nev, Helyszin.nev AS helyszin
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Kaszt ON Jatekos.kasztId = Kaszt.id
JOIN Kepesseg ON Kaszt.id = Kepesseg.kasztId
JOIN Helyszin ON Jatekos.helyszinId = Helyszin.id
WHERE Kepesseg.sebzesModosito IS NOT NULL;

-- 48. Az összes csoport neve és tagjainak száma, ahol a tagok átlagos szintje meghaladja az átlagos szintet az összes játékos között.
SELECT Csoport.nev, COUNT(*) AS tagok_szama
FROM Csoport
JOIN Jatekos ON Csoport.id = Jatekos.csoportId
GROUP BY Csoport.nev
HAVING AVG(Jatekos.szint) > (
    SELECT AVG(szint) FROM Jatekos
);

-- 49. Az összes játékos neve és szervere, akiknek a nevében és a csoportjuk nevében is megtalálható a "cs" karakterkombináció.
SELECT Felhasznalo.nev, Szerver.nev AS szerver
FROM Felhasznalo
JOIN Jatekos ON Felhasznalo.id = Jatekos.felhasznaloId
JOIN Szerver ON Jatekos.szerverId = Szerver.id
JOIN Csoport ON Jatekos.csoportId = Csoport.id
WHERE Felhasznalo.nev LIKE '%cs%' AND Csoport.nev LIKE '%cs%';
